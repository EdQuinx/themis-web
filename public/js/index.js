!function(e){function t(t){for(var a,i,c=t[0],r=t[1],o=t[2],m=0,d=[];m<c.length;m++)i=c[m],s[i]&&d.push(s[i][0]),s[i]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);for(u&&u(t);d.length;)d.shift()();return l.push.apply(l,o||[]),n()}function n(){for(var e,t=0;t<l.length;t++){for(var n=l[t],a=!0,c=1;c<n.length;c++){var r=n[c];0!==s[r]&&(a=!1)}a&&(l.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},s={1:0},l=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonp=window.webpackJsonp||[],r=c.push.bind(c);c.push=t,c=c.slice();for(var o=0;o<c.length;o++)t(c[o]);var u=r;l.push([298,0,3]),n()}({298:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),l=n(18),i=n.n(l),c=n(16),r=n(25);const o={"C++":"cpp",Pascal:"pas",Python:"py",Java:"java"},u={cpp:"C++",pas:"Pascal",py:"Python",java:"Java"};function m(e){return e.filename+"."+o[e.lang]}class d{constructor({filename:e,lang:t,content:n="",saveStatus:a="saved",result:s}){this.id=++d.id,this.filename=e,this.lang=t,this.content=n,this.saveStatus=a,this.result=s}get name(){return m(this)}toSend(){return{filename:this.filename,lang:this.lang,content:this.content}}}d.id=0;var b=n(46),p=n.n(b),f=n(5),E=n(142),h=n.n(E);n(153),n(154),n(157);var g=(e={list:[],selected:null},t)=>{if("ADD_SUBMISSION"===t.type){const n=new d(t.payload),a=e.list.findIndex(e=>m(e)===m(n));return-1!==a?Object.assign({},e,{selected:a}):Object.assign({},e,{list:[...e.list,n],selected:e.list.length})}if("SELECT_SUBMISSION"===t.type)return Object.assign({},e,{selected:e.list.findIndex(e=>m(e)===t.payload.filename)});if("payload"in t&&t.payload&&"number"!=typeof t.payload&&null!==t.payload&&"filename"in t.payload){const n=Object.assign({},e,{list:function(e,t,n){const a=e.findIndex(e=>t===m(e));if(void 0===e[a])return e;const s=function(e,t){switch(t.type){case"REMOVE_SUBMISSION":return;case"EDIT_SUBMISSION":return Object.assign({},e,{content:t.payload.content,saveStatus:"saved",result:void 0});case"SUBMIT_REQUEST":return Object.assign({},e,{saveStatus:"submitting"});case"SUBMIT_SUCCESS":return Object.assign({},e,{saveStatus:"submitted"});case"SUBMIT_FAILURE":return async function(e,t,n=!1){p.a.Permission.has()&&!n&&null!==await p.a.create(e,{body:t})||new h.a({text:`<div><h3>${e}</h3></div><div>${t}</div>`,sounds:{sources:["/public/notification.ogg"],conditions:["docVisible","docHidden"]}}).show()}(`File ${e.filename} failed to submit`,`An error has occured: ${t.payload.err.message}`),Object.assign({},e,{saveStatus:"saved"})}const n=function(e,t){switch(t.type){case"LOG_SUCCESS":return t.payload.log;case"LOG_FAILURE":return console.log(t.payload.err),e;default:return e}}(e.result,t);return n!==e.result?Object.assign({},e,{result:n}):e}(e[a],n);if(s!==e[a]){const t=e.slice();return void 0===s?t.splice(a,1):t[a]=s,t}return e}(e.list,t.payload.filename,t)});return null!==n.selected&&n.selected>=n.list.length&&(n.selected=0===n.list.length?null:n.selected-1),n}return e};var O=(e={list:{},status:"done"},t)=>{switch(t.type){case"FILES_REQUEST":return Object.assign({},e,{status:"loading"});case"FILES_SUCCESS":return Object.assign({},e,{list:t.payload,status:"done"});case"FILES_FAILURE":console.log("Files list fetching failed: "+t.payload.err.message)}return e};var S=Object(r.c)({addForm:(e={filename:"",lang:"C++"},t)=>"CHANGE_ADD_FORM"===t.type?Object.assign({},e,t.payload):e,uploadForm:(e={file:null,uploading:!1},t)=>{switch(t.type){case"CHANGE_UPLOAD_FORM":return Object.assign({},e,t.payload);case"UPLOAD_REQUEST":return Object.assign({},e,{uploading:!0});case"UPLOAD_SUCCESS":return Object.assign({},e,{uploading:!1})}return e}});var v=(e=null,t)=>{switch(t.type){case"CONTEST_SUCCESS":return t.payload;case"CONTEST_FAILURE":return console.log("Contest clock failed to fetch: "+t.payload.err.message),e}return e};var j=Object(r.c)({submissions:g,files:O,addForms:S,queue:function(e={items:0,status:"done"},t){switch(t.type){case"QUEUE_REQUEST":return Object.assign({},e,{status:"loading"});case"QUEUE_SUCCESS":return{items:t.payload,status:"done"};case"QUEUE_FAILURE":return console.log("Queue fetch failed: "+t.payload.err.message),Object.assign({},e,{status:"done"})}return e},contestClock:v}),y=n(302),U=n(303),C=n(6),w=n(7);const _=Object(w.createAsyncAction)("LOG_REQUEST","LOG_SUCCESS","LOG_FAILURE")();var A=n(299),I=n(304),T=n(52),N=n.n(T);function F(e){return Object(A.a)(N.a.get(e,{withCredentials:!0}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):e.data))}function k(e,t={}){return Object(A.a)(N.a.post(e,t,{withCredentials:!0}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):e.data))}var L=n(19),M=n(301);var R=e=>e.pipe(Object(C.filter)(Object(w.isActionOf)(_.request)),Object(C.groupBy)(e=>e.payload.filename),Object(C.mergeMap)(t=>t.pipe(Object(C.switchMap)(t=>(function(e,t){return function(e,t,n){return Object(I.a)(t).pipe(Object(C.takeUntil)(n),Object(C.switchMap)(e))}(()=>k("/log",{user:window.username,problem:Object(L.basename)(e.payload.filename,Object(L.extname)(e.payload.filename)),ext:Object(L.extname)(e.payload.filename)}),5e3,t.pipe(Object(C.filter)(t=>(function(e,t=!0){return("EDIT_SUBMISSION"===e.type||"REMOVE_SUBMISSION"===e.type||"SUBMIT_REQUEST"===e.type)&&e.payload.filename===t||"LOG_SUCCESS"===e.type&&(!0===t||e.payload.filename===t)&&void 0!==e.payload.log})(t,e.payload.filename)))).pipe(Object(C.map)(t=>_.success(Object.assign({},e.payload,{log:null===t?void 0:t.content}))),Object(C.catchError)(t=>Object(M.a)(_.failure(Object.assign({},e.payload,{err:t})))))})(t,e)))));const x=Object(w.createStandardAction)("EDIT_SUBMISSION")(),P=Object(w.createAsyncAction)("SUBMIT_REQUEST","SUBMIT_SUCCESS","SUBMIT_FAILURE")();var D=Object(U.a)((e,t)=>e.pipe(Object(C.filter)(Object(w.isActionOf)(P.request)),Object(C.mergeMap)(e=>(function(e,t){const n=t.submissions.list.find(t=>m(t)===e.payload.filename);return n?k("/submit",{problem:n.filename,ext:"."+o[n.lang],content:n.content}).pipe(Object(C.map)(()=>P.success(e.payload)),Object(C.catchError)(t=>Object(M.a)(P.failure(Object.assign({},e.payload,{err:t}))))):Object(M.a)()})(e,t.value))),e=>e.pipe(Object(C.filter)(Object(w.isActionOf)(P.success)),Object(C.map)(e=>_.request(e.payload))));const B=Object(w.createAsyncAction)("FILES_REQUEST","FILES_SUCCESS","FILES_FAILURE")();var q=(e,t)=>e.pipe(Object(C.filter)(Object(w.isActionOf)(B.request)),Object(C.switchMap)(Q));function Q(e){return F("/files").pipe(Object(C.map)(e=>B.success(e)),Object(C.catchError)(e=>Object(M.a)(B.failure({err:e}))))}var G=Object(w.createAsyncAction)("QUEUE_REQUEST","QUEUE_SUCCESS","QUEUE_FAILURE")();var $=(e,t)=>e.pipe(Object(C.filter)(Object(w.isActionOf)(G.request)),Object(C.switchMap)(J));function J(e){return k("/queue").pipe(Object(C.map)(e=>G.success(e)),Object(C.catchError)(e=>Object(M.a)(G.failure({err:e}))))}const H=Object(w.createAsyncAction)("CONTEST_REQUEST","CONTEST_SUCCESS","CONTEST_FAILURE")();var V=(e,t)=>e.pipe(Object(C.filter)(Object(w.isActionOf)(H.request)),Object(C.switchMap)(K));function K(e){return F("/contest").pipe(Object(C.map)(e=>null===e?null:{startTime:new Date(e.startTime),endTime:new Date(e.endTime)}),Object(C.map)(e=>H.success(e)),Object(C.catchError)(e=>Object(M.a)(H.failure(e))))}var z=Object(U.a)(R,D,q,$,V);const Y=Object(y.a)(),W=r.d,X=Object(r.e)(j,function(e){return"list"in e?(e.list=e.list.map(e=>("submitting"===e.saveStatus&&(e.saveStatus="saved"),e)),e):{}}(JSON.parse(localStorage.getItem(window.username+"_v0.4")||"{}")),W(Object(r.a)(Y)));var Z=X;function ee(e,t){return e(),setInterval(e,t)}Y.run(z),X.subscribe(()=>{localStorage.setItem(window.username+"_v0.4",JSON.stringify(X.getState()))}),ee(()=>X.dispatch(B.request()),6e4),ee(()=>X.dispatch(H.request()),6e4),function(){const e=X.getState();for(const t of e.submissions.list)"submitted"===t.saveStatus&&void 0===t.result&&X.dispatch(_.request({filename:m(t)}))}();var te=n(54);const ne=Object(w.createStandardAction)("SELECT_SUBMISSION")(),ae=Object(w.createStandardAction)("ADD_SUBMISSION")(),se=Object(w.createStandardAction)("REMOVE_SUBMISSION")();var le=n(28);function ie({saveStatus:e,verdict:t}){switch(e){case"saved":return s.a.createElement(f.b,{color:"info"},"✓ Đã lưu");case"submitting":return s.a.createElement(f.b,{color:"secondary"},"Đang nộp")}return t?"Yes"===t?s.a.createElement(f.b,{color:"success"},s.a.createElement("img",{className:"img-fluid",src:"/public/img/tick.png",height:"25",width:"25"})):s.a.createElement(f.b,{color:"success"},s.a.createElement("span",null,t)):s.a.createElement(f.b,null,s.a.createElement("img",{className:"img-fluid",src:"/public/img/giphy.gif",height:"25",width:"25"}))}var ce=Object(c.b)(void 0,(e,t)=>({onRemove:()=>e(se({filename:m(t.submission)})),onSelect:()=>e(ne({filename:m(t.submission)}))}))(function({submission:e,onRemove:t,onSelect:n,isActive:a}){return s.a.createElement(f.i,{active:a,onClick:n},s.a.createElement(f.c,{color:"danger",onClick:function(e){return t=>{t.stopPropagation(),confirm("Bạn có muốn xóa bài làm không?")&&e()}}(t)},s.a.createElement(le.a,{icon:"times-circle"})),s.a.createElement("span",null,` ${e.filename}.${o[e.lang]} `),"submitted"===e.saveStatus?s.a.createElement(ie,{saveStatus:e.saveStatus,verdict:e.result?e.result.verdict.toString():void 0}):null)});var re=Object(c.b)(e=>({submissions:e.submissions.list,selected:e.submissions.selected}))(function({submissions:e,selected:t}){return s.a.createElement("div",null,s.a.createElement("h4",null,"Các bài nộp"),s.a.createElement(f.h,{style:{position:"relative"}},s.a.createElement(te.a,{typeName:null},e.map((e,n)=>s.a.createElement(ce,{key:m(e),submission:e,isActive:n===t})),0===e.length?s.a.createElement("li",{className:"list-group-item",key:"empty"},"Không có file nào"):null)))});function oe({id:e,name:t}){return s.a.createElement("a",{href:`/files/${e}`},s.a.createElement(f.i,null,t))}var ue=Object(c.b)(e=>({files:e.files.list,disableRefresh:"loading"===e.files.status}),e=>({onRefresh:()=>e(B.request())}))(function({files:e,onRefresh:t}){return s.a.createElement("div",null,s.a.createElement("h4",null,"Tải xuống",s.a.createElement("span",{className:"float-md-right"},s.a.createElement(f.c,{size:"sm",color:"info",onClick:t},s.a.createElement(le.a,{icon:"sync"})))),s.a.createElement(f.h,null,Object.keys(e).map(t=>s.a.createElement(oe,{key:t,id:t,name:e[t]})),Object.keys(e).length?null:s.a.createElement(f.i,null,"Không có file nào")))});var me=function(e,t,n){return n?Object(c.b)(e,e=>({dispatch:e}),(e,{dispatch:a})=>n(e,t(a,e))):Object(c.b)(e,e=>({dispatch:e}),(e,{dispatch:n})=>Object.assign({},e,t(n,e)))};const de=Object(w.createStandardAction)("CHANGE_ADD_FORM")(),be=Object(w.createStandardAction)("CHANGE_UPLOAD_FORM")(),pe=Object(w.createAsyncAction)("UPLOAD_REQUEST","UPLOAD_SUCCESS","UPLOAD_FAILURE")(),fe=me(e=>{const t=e.addForms.addForm;let n=!0;return""===t.filename?n="Tên không được phép rỗng":e.submissions.list.some(e=>m(e)===m(t))&&(n="File đã tồn tại"),Object.assign({},t,{available:n})},(e,t)=>({onFilenameChange:t=>e(de({filename:t.toUpperCase()})),onLangChange:t=>e(de({lang:t})),onSubmit:()=>{e(ae(t)),e(de({filename:""}))}}))(function({filename:e,lang:t,onFilenameChange:n,onLangChange:a,onSubmit:l,available:i}){return s.a.createElement("div",null,s.a.createElement("h5",null,"Tạo file mới"),s.a.createElement(f.e,{inline:!0,className:"justify-content-between",onSubmit:he(l)},s.a.createElement(f.f,null,s.a.createElement(f.g,{type:"text",placeholder:"Tên bài",value:e,onChange:e=>n(e.target.value),invalid:!0!==i,title:!0===i?"":i})),s.a.createElement("select",{className:"form-control",value:t,onChange:e=>a(e.target.value)},Object.keys(o).map(e=>s.a.createElement("option",{key:e},e))),s.a.createElement(f.c,{type:"submit",color:"primary",disabled:!0!==i},s.a.createElement(le.a,{icon:"check"}))))});const Ee=me(e=>Object.assign({},e.addForms.uploadForm,{available:function(e,t){if(null===e)return"File không được phép rỗng";const n=Object(L.basename)(e.name,Object(L.extname)(e.name)).toUpperCase(),a=(""===Object(L.extname)(e.name)?"":Object(L.extname)(e.name).slice(1)).toLowerCase();if(!(a in u))return"Ngôn ngữ không được hỗ trợ: "+a;if(t.submissions.list.some(e=>m(e)===n+"."+a))return"File đã tồn tại trong danh sách";if(e.size>1048576)return"File quá lớn";return!0}(e.addForms.uploadForm.file,e)}),(e,t)=>({onFileChange:t=>e(be({file:t})),onSubmit:()=>(function(e,{file:t}){if(null===t)return;e(pe.request());const n=Object(L.basename)(t.name,Object(L.extname)(t.name)).toUpperCase(),a=(""===Object(L.extname)(t.name)?"":Object(L.extname)(t.name).slice(1)).toLowerCase(),s=u[a],l=new FileReader;l.onload=(()=>{e(ae({filename:n,lang:s,content:l.result})),e(pe.success())}),l.readAsText(t)})(e,t)}))(function({uploading:e,available:t,onFileChange:n,onSubmit:a}){return s.a.createElement("div",null,s.a.createElement("h5",null,"Tải lên file mới"),s.a.createElement(f.e,{inline:!0,className:"justify-content-between",onSubmit:he(a)},s.a.createElement(f.f,null,s.a.createElement(f.g,{type:"file",placeholder:"Upload",onChange:e=>n(null===e.target.files?null:e.target.files[0]||null),invalid:!0!==t,title:!0===t?"":t})),s.a.createElement(f.c,{type:"submit",color:"primary",disabled:e||!0!==t},s.a.createElement(le.a,{icon:"upload"}))))});function he(e){return t=>{t.preventDefault(),e()}}n(90);var ge=n(72),Oe=n.n(ge);function Se(e){return e.toString()}Oe.a.setLabels(" mili-giây| giây| phút| giờ| ngày| tuần| tháng| năm| thập kỉ| thế kỉ| thiên niên kỉ"," mili-giây| giây| phút| giờ| ngày| tuần| tháng| năm| thập kỉ| thế kỉ| thiên niên kỉ"," và ",", ","ngay bây giờ");var ve=Object(c.b)(e=>({clock:e.contestClock}))(class extends a.Component{constructor(){super(...arguments),this.timer=setInterval(()=>this.setState({now:new Date}),1e3),this.state={now:new Date}}componentWillUnmount(){clearInterval(this.timer)}render(){if(!this.props.clock)return null;const{startTime:e,endTime:t}=this.props.clock,{now:n}=this.state;let a=null;return a=e>n?s.a.createElement("h4",null,"Cuộc thi sẽ bắt đầu trong ",s.a.createElement("b",null,Se(Oe()(n,e))),"."):t>n?s.a.createElement("h4",null,"Cuộc thi sẽ kết thúc sau ",s.a.createElement("b",null,Se(Oe()(n,t)))):s.a.createElement("h4",null,"Cuộc thi đã kết thúc."),s.a.createElement("div",null,a,s.a.createElement("hr",null))}}),je=n(144),ye=n.n(je);n(91);n(291),n(292),n(293),n(294),n(296);const Ue={"C++":"c_cpp",Pascal:"pascal",Python:"python",Java:"java"};const Ce=me(e=>({submission:e.submissions.list[e.submissions.selected]}),(e,t)=>({onChange:n=>e(x({filename:m(t.submission),content:n}))}))(function({submission:e,onChange:t}){return s.a.createElement(ye.a,{style:{width:"100%"},mode:Ue[e.lang],theme:"monokai",name:"editor",onChange:t,value:e.content,editorProps:{$blockScrolling:!0}})});var we=me(e=>({submission:e.submissions.list[e.submissions.selected]}),(e,t)=>({onSubmit:()=>e(P.request({filename:m(t.submission)}))}),(e,t)=>({saveStatus:e.submission.saveStatus,onSubmit:t.onSubmit}))(function({saveStatus:e,onSubmit:t}){return s.a.createElement("div",null,s.a.createElement("h4",{className:"row justify-content-between"},s.a.createElement("span",null,"Soạn code"),s.a.createElement("span",null,s.a.createElement(f.c,{color:"success",className:"form-control",disabled:"saved"!==e,onClick:t},"saved"===e?"Nộp bài":"submitting"===e?"Đang nộp bài...":"Đã nộp bài"))),s.a.createElement(Ce,null))});var _e=Object(c.b)(e=>({queue:e.queue.items}))(function({saveStatus:e,result:t,queue:n}){if("submitted"!==e)return null;if(void 0===t)return s.a.createElement("h5",{className:"text-center"},"Bài của bạn đang được chấm (",n," bài đang chờ)...");if("Yes"===t.verdict)return s.a.createElement("h5",{className:"text-center"},"Bài của bạn đã được chấm. Tuy nhiên, kết quả không được công bố.");if("string"==typeof t.details)return s.a.createElement("div",null,s.a.createElement("h4",null,"Biên dịch gặp lỗi"),s.a.createElement("pre",null,t.details));return s.a.createElement("div",null,s.a.createElement("hr",null),s.a.createElement("h4",{className:"row justify-content-between"},s.a.createElement("span",null,"Kết quả chấm"),s.a.createElement("span",null,"Điểm của bạn: ",s.a.createElement("b",null,t.verdict))),s.a.createElement(f.h,null,t.details.map(e=>s.a.createElement(Ae,Object.assign({},e,{key:e.id})))))});function Ae({id:e,verdict:t,time:n,score:a}){return s.a.createElement(f.i,null,s.a.createElement("div",{className:"row justify-content-between",style:{padding:10}},s.a.createElement("span",null,e,":"," ",s.a.createElement("span",{className:"font-weight-bold"},Math.round(1e3*a)/1e3)),s.a.createElement("span",null,"Thời gian chạy:"," ",s.a.createElement("span",{className:"font-weight-bold"},Math.round(1e3*n)/1e3)," ","giây")),s.a.createElement(f.d,{body:!0,color:"light"},s.a.createElement("samp",{style:{whiteSpace:"pre-wrap"}},t)))}var Ie=Object(c.b)(e=>null===e.submissions.selected?{submission:null}:{submission:e.submissions.list[e.submissions.selected]})(function({submission:e}){if(null===e)return s.a.createElement("h3",{className:"text-center"},"Mở hoặc tạo một file mới để tiếp tục");return s.a.createElement("div",null,s.a.createElement(we,null),s.a.createElement(_e,{saveStatus:e.saveStatus,result:e.result}))});i.a.render(s.a.createElement(c.a,{store:Z},s.a.createElement("div",null,s.a.createElement(class extends a.Component{constructor(){super(...arguments),this.state={display:p.a.Permission.get()===p.a.Permission.DEFAULT}}render(){return s.a.createElement(f.a,{isOpen:this.state.display,color:"primary"},"Please allow notifications for score announcements and submit reporters.",s.a.createElement("a",{href:"#",className:"float-right",onClick:()=>{p.a.Permission.request(),this.setState({display:!1})}},"Allow or Deny"))}},null),s.a.createElement(ve,null),s.a.createElement("div",{className:"container-fluid"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-3"},s.a.createElement(function(){return s.a.createElement("div",null,s.a.createElement(re,null),s.a.createElement("hr",null),s.a.createElement(fe,null),s.a.createElement("br",null),s.a.createElement(Ee,null),s.a.createElement("hr",null),s.a.createElement(ue,null))},null)),s.a.createElement("div",{className:"col-md-9"},s.a.createElement(Ie,null)))))),document.getElementById("root"))},90:function(e,t,n){"use strict";var a=n(41),s=n(26);a.b.add(s.b,s.c,s.a,s.d)}});
//# sourceMappingURL=index.js.map